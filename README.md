# 概要

このプロジェクトは `Amazon Transcribe` サービスを利用し、取得した音声データをテキストデータに変換します。

**主な機能：**

1. ブラウザで音声ファイルを選択、またはマイクで音声を録音し、音声データをサーバーに送信します。その後、サーバーから変換後のテキストデータを取得します。
2. ブラウザのページで検索したいテキストを入力すると、変換後のテキストデータから全てのマッチング箇所を検索し、ハイライト表示を実現します。

**アクセス方法：**

[https://transcription.hushukang.com/](https://transcription.hushukang.com/)

## 使用技術スタック

**◾️ フロントエンド：**
| No | 役割 | 技術スタック |
| :- | :- | :- |
| 1 | プログラミング言語 | TypeScript |
| 2 | フレームワーク | React, react-router v7 |
| 3 | style | shadcn/ui, tailwindcss |
| 4 | ビルドツール | vite |
| 5 | コードチェック | eslint, prettier |

**◾️ サーバーサイド：**
| No | 役割 | 技術スタック |
| :- | :- | :- |
| 1 | プログラミング言語 | TypeScript |
| 2 | ミドルウェア | aws-lambda-powertools, middy |
| 3 | ユニットテスト | vitest |
| 4 | データバリデーション | zod |
| 5 | 環境変数 | dotenv |
| 6 | コードチェック | eslint, prettier |

**◾️ インフラ：**
| No | 役割 | 技術スタック |
| :- | :- | :- |
| 1 | 音声認識 | AWS Transcribe |
| 2 | CDN | AWS CloudFront |
| 3 | 静的ファイルストレージ | AWS S3 |
| 4 | DNS | AWS Route 53 |
| 5 | SSL証明書管理 | AWS Certificate Manager |
| 6 | シークレット管理 | AWS Secret Manager（CloudFront署名付きURLのプライベートキー） |
| 7 | APIゲートウェイ | AWS API Gateway |
| 8 | サーバー(サーバーレス) | AWS Lambda |
| 9 | ファイルアップロード方式 | CloudFront署名付きURL |
| 10 | AWSデプロイ | CDK(IaC) |

## システム構成図

![システム構成図](./doc/システム構成図.jpg 'システム構成図')

## シーケンス図

![シーケンス図](./doc/シーケンス図.jpg 'シーケンス図')

# プロジェクトのポイント

1. `AWS Lambda`をサーバーとして利用することで、サーバーのスケーラビリティを大幅に向上させ、同時にサーバーの費用を大幅に削減します。
2. `CloudFront署名付きURL`を使用してファイルをアップロードすることで、ファイル操作時のサーバー負荷を回避し、ファイル経由でのサーバーへの攻撃を防ぎ、さらにサーバー費用を削減します。
3. `CloudFront`をCDNとして利用することで、静的ファイルを効果的にキャッシュし、ユーザーのアクセス速度を向上させると同時に、S3の費用を削減します。
4. `AWS Secret Manager`を利用してURL署名用のプライベートキーを管理し、セキュリティを向上させます。
5. `CDK(IaC)`を利用してリソースをデプロイすることで、将来的なマルチ環境へのデプロイを容易にし、手動でのデプロイコストを削減します。
6. `aws-lambda-powertools`と`middy`をLambdaのミドルウェアとして採用し、AWS公式が推奨するLambda開発のベストプラクティスに従うことで、開発効率とコードの可読性を向上させます。
7. `react-router v7`を採用し、最新の開発スタイルに適合させます。
8. ヘッドレスUIコンポーネントである`shadcn/ui`を利用することで、開発効率と可読性を向上させ、将来的なフロントエンドのスタイル変更に対する柔軟性を確保します。
9. ユニットテストに`Vitest`を採用することで、従来の`Jest`と比較して実行速度を向上させます。
10. フロントエンドとバックエンドを分離することで、チーム開発に適した構成にし、プロジェクトのスケーラビリティとメンテナンス性を向上させます。

# ローカルでの実行方法

## サーバーサイド video2text-api

サーバーサイドは`AWS Lambda`や`Secret Manager`などのAWSサービスに依存しているため、現在ローカルでの実行はできません。ただし、ユニットテストはローカルで実行可能です。

ユニットテストの実行方法：まず、プロジェクトのルートディレクトリで以下のコマンドを実行し、依存関係をインストールします。

```shell
npm install
```

その後、以下のコマンドを実行することでローカルでテストを実行できます。

```shell
npm run test
```

## フロントエンド video2text-client

まず、プロジェクトのルートディレクトリで以下のコマンドを実行し、依存関係をインストールします。

```shell
npm install
```

その後、以下のコマンドを実行することでローカルで実行できます。

```shell
npm run dev
```

> 注意：ローカルで実行する場合、CloudFrontの設定によりクロスオリジンアクセスが許可されていないため、ローカルから音声ファイルをアップロードすることはできません。

# AWSへのデプロイ方法

## サーバーサイド video2text-api

例えば `it` 環境をデプロイする場合、まず必要な環境変数を `env/.env.it` に記入し、その後、以下のコマンドを実行するとサーバーサイドをAWSにデプロイできます。

```shell
npm run deploy:api:it
```

## フロントエンド video2text-client

例えば `it` 環境をデプロイする場合、まず必要な環境変数を `env/.env.it`に記入し、その後、以下のコマンドを実行します。

```shell
npm run deploy:it
```
